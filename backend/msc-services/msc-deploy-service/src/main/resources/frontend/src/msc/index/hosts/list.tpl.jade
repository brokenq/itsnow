mixin progressBar(capacity, processPercent, schemaPercent)
  .progress
    .progress-bar.progress-bar-success.progress-bar-striped.active(style="width: #{processPercent}%") #{processPercent}%
    .progress-bar.progress-bar-info.progress-bar-striped.active(style="width: #{schemaPercent}%") #{schemaPercent}%

include /lib/mixins/list

.datalist
  +toolbar
    +button_group
      +tool_button("hostsTable.reload()", "refresh", "", "*", "", "")
    +button_group
      +tool_button("actionService.gotoState('hosts.new', $event)", "plus", "新增", "*", "", "")
      +tool_button("actionService.gotoState('hosts.edit', $event)", "pencil", "修改", "1", "", "editable")
    +more_buttons
      +drop_button("actionService.perform(destroy, $event)", "trash", "删除", "1+", "shutdown", "deletable")

  +page_table("hostsTable", "selectionService")
    +row("host", "id", "selectionService")(class="editable", ng-class="(host.processesCount > 0 || host.schemasCount > 0 ? '' : 'deletable')+ ' ' +host.status.toLowerCase()")
      td(data-title="'名称'")
        a(ui-sref="hosts.view(host)") {{host.name}}
      td(data-title="'地址'")
        a(href="ssh://root@${{host.address}}") {{host.address}}
      td(data-title="'类型'") {{host.type | formatHostType}}
      td(data-title="'使用率'")
        +progressBar("{{host.capacity}}", "{{host.processesCount/host.capacity*100 | round}}", "{{host.schemasCount/host.capacity*100 | round}}")
      td(data-title="'状态'") {{host.status | formatHostStatus}}
