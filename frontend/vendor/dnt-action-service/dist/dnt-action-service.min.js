/*! dnt-action-service 16-10-2014 */
(function(){angular.module("dnt.action.service",["ui.router"]).factory("ActionService",["$rootScope","$state",function(a,b){var c;return c=function(){function a(a){this.options=a}return a.prototype.CODE={TR_VALUE:"value"},a.prototype.CSS={WEIGHT:"weight",REJECT_CSS:"reject-css",REQUIRE_CSS:"require-css"},a.prototype.INFO={REJECT:"you must select {0} records to perform this action",REJECT_AT_LEAST:"you must select {0} records to perform this action at least",CHECK_STATUS:"you can't perform this action, please check the status of records which were selected"},a.prototype.passedSelections=function(a){var b,c;return b=this.getConditions(a),c=this.getSelections(),this.checkConditionPass(b,c),c.datas},a.prototype.gotoState=function(a,c){var d,e;try{return e=this.passedSelections(c),b.go(a,e[0])}catch(f){return d=f,alert(d)}},a.prototype.perform=function(a,b){var c,d,e,f,g,h;try{if(e=this.passedSelections(b),1===a.length){for(h=[],f=0,g=e.length;g>f;f++)d=e[f],h.push(a(d));return h}return a.apply(this,e)}catch(i){return c=i,alert(c)}},a.prototype.checkConditionPass=function(a,b){var c,d;if(/^\d+$/.test(a.weight)){if(d=parseInt(a.weight),d===b.datas.length)return void this.checkStatus(a,b);throw this.stringFormat(this.INFO.REJECT,d)}if(/^\d+\+$/.test(a.weight)){if(c=parseInt(a.weight.split(/\+/)[0]),b.datas.length>=c)return void this.checkStatus(a,b);throw this.stringFormat(this.INFO.REJECT_AT_LEAST,c)}},a.prototype.checkStatus=function(a,b){if(!this.isCssPass(a,b))throw this.INFO.CHECK_STATUS},a.prototype.isCssPass=function(a,b){var c,d;return c=this.getCss(a.rejectCss),d=this.getCss(a.requireCss),this.isReject(c,b.trs)?!1:this.isRequire(d,b.trs)},a.prototype.isReject=function(a,b){var c,d,e,f,g;for(f=0,g=b.length;g>f;f++){d=b[f],e=this.getClass(d);for(c in a)if(null!=e[c])return!0}return!1},a.prototype.isRequire=function(a,b){var c,d,e,f,g;for(f=0,g=b.length;g>f;f++){d=b[f],e=this.getClass(d);for(c in a)if(null==e[c])return!1}return!0},a.prototype.getConditions=function(a){var b,c;return c=$(a.srcElement||a.target),b={weight:c.attr(this.CSS.WEIGHT),rejectCss:c.attr(this.CSS.REJECT_CSS),requireCss:c.attr(this.CSS.REQUIRE_CSS)}},a.prototype.getSelections=function(){var a,b,c,d;b={datas:[],trs:[]},d=this.options.watch;for(a in d)c=d[a],c&&(b.datas.push(this.options.mapping(a)),b.trs.push($("["+this.CODE.TR_VALUE+"="+a+"]")));return b},a.prototype.getCss=function(a){var b,c,d,e,f;if(c={},null!=a&&""!==a)for(f=a.split(/\s+/),d=0,e=f.length;e>d;d++)b=f[d],c[b]=b;return c},a.prototype.getClass=function(a){return this.getCss($(a).attr("class"))},a.prototype.stringFormat=function(){var a,b,c,d,e,f;if(0===arguments.length)return null;for(c=arguments[0],a=e=0,f=arguments.length;f>e;a=++e)d=arguments[a],0!==a&&(b=new RegExp("\\{"+(a-1)+"\\}","gm"),c=c.replace(b,d));return c},a.make=function(b){return new a(b)},a}()}])}).call(this);